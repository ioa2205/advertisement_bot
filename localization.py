# selling_bot/localization.py
from telegram.ext import ContextTypes
from config import DEFAULT_LANGUAGE, SUPPORTED_LANGUAGES, MAX_MEDIA_ITEMS, CATEGORIES_KEYS # MAX_DESCRIPTION_LENGTH removed temporarily from here, handled in get_text
# from config import MAX_DESCRIPTION_LENGTH # Import directly in get_text if needed

strings = {
    'en': {
        # --- General & Existing ---
        "welcome": "Hi {name}! Please choose your language:",
        "lang_chosen": "Language set to English.",
        "choose_category": "What do you want to sell?",
        # Category chosen will be followed by the first specific question for that category
        "ask_price": "What's the *asking price*? (e.g., $15,000 or 15000 USD)", # Generic price prompt
        "ask_location": "In which *city or district* is the item located?", # Generic location prompt
        "ask_description": "Add a *brief description* (optional, max {max_desc_len} chars).\nSend your description or use the button below to skip.",
        "ask_media": "Upload photos or videos (up to {max_media} files).\nSend your media, then use the buttons below.",
        "media_received": "Media received ({count}/{max_media}). Send more or press 'Done'.",
        "max_media_reached": "Maximum number of media files ({max_media}) reached. Press 'Done'.",
        "no_media_uploaded_error": "Please upload at least one photo or video.",
        "preview_confirm_prompt": "\n‚Äî ‚Äî ‚Äî ‚Äî ‚Äî\n\n‚úÖ Confirm to publish?\nChoose an option:",
        "btn_post": "‚úÖ Post", "btn_edit": "‚úèÔ∏è Edit", "btn_cancel": "‚ùå Cancel",
        "post_successful_channel": "‚úÖ Successfully posted to {target_chat_id}!",
        "post_successful_admin": "‚úÖ Your ad has been submitted for review!",
        "post_cancelled": "Publication cancelled. You can start over with /start.",
        "edit_choice_prompt": "What would you like to edit? (Note: Some fields may require restarting that section)", # Updated edit prompt
        "btn_edit_price": "üí∞ Price", "btn_edit_location": "üó∫Ô∏è Location", "btn_edit_description": "üìÑ Description", "btn_edit_media": "üñºÔ∏è Media",
        "btn_back_to_preview": "‚Ü©Ô∏è Back to Preview", "btn_done_media": "‚úÖ Done Uploading", "btn_clear_media": "üîÑ Clear All Media",
        "btn_skip": "‚û°Ô∏è Skip", # Generic Skip button
        "btn_skip_description": "‚û°Ô∏è Skip Description", # Can be merged with btn_skip if context is clear
        "description_skipped": "Description skipped.", "media_cleared": "All media cleared. You can now upload new ones.",
        "invalid_input": "Sorry, I didn't understand that. Please follow the instructions or use the buttons provided.",
        "price_invalid": "Invalid price format. Please enter a valid price (e.g., 15000, $15000, 150.00 EUR).",
        "description_too_long": "Description is too long (max {max_desc_len} characters). Please shorten it.",
        "general_error": "An error occurred. Please try again or type /cancel to restart.",
        "timeout_message": "Conversation timed out due to inactivity. Please start over with /start.",
        "conversation_restarted": "The previous operation was cancelled. Let's start over.",
        "category_cars": "üöó Cars", "category_houses": "üè† Real Estate", "category_animals": "üêÑ Animals", "category_other": "üß∏ Other",
        "change_language_prompt": "Please choose your new language:",
        "language_changed_success": "Language successfully changed to {new_lang_display}. Your current ad creation process has been reset. Please use /start to begin a new ad.",
        "help_message": (
            "Welcome to the Ad Posting Bot!\n\n"
            "Here's how to create an ad:\n"
            "1. Use /start to begin.\n"
            "2. Select a category and follow the prompts for details.\n"
            "3. Upload photos/videos when asked.\n"
            "4. Review your ad and then post, edit, or cancel.\n\n"
            "Available commands:\n"
            "/start - Create a new ad.\n"
            "/language - Change your preferred language.\n"
            "/help - Show this help message.\n"
            "/cancel - Cancel the current ad creation process."
        ),
        "field_skipped": "{field_name} skipped.", # Generic skip message

        # --- Category: Cars ---
        "category_chosen_cars": "üöó Great! Let's get details for the car.",
        "ask_car_make_model": "What's the *Make and Model* of the car (e.g., Toyota Camry, BMW X5)?",
        "ask_car_year": "What's the car's *Year of Manufacture* (e.g., 2018)? (Optional)",
        "ask_car_mileage": "What's the car's *Mileage* (e.g., 55000 km or 30000 miles)?",
        "preview_title_cars": "üì¢ **Car for Sale**",
        "preview_field_car_make_model": "**Make/Model:** {value}",
        "preview_field_car_year": "**Year:** {value}",
        "preview_field_car_mileage": "üõ£Ô∏è **Mileage:** {value}",
        "btn_edit_car_make_model": "Make/Model",
        "btn_edit_car_year": "Year",
        "btn_edit_car_mileage": "Mileage",

        # --- Category: Houses/Real Estate ---
        "category_chosen_houses": "üè† Okay! Let's get details for the property.",
        "ask_house_property_type": "What *type of property* is it?",
        "ask_house_rooms": "How many *rooms* does it have (e.g., 3)? (Optional)",
        "ask_house_area": "What's the approximate *area or size* (e.g., 75 sqm, 1200 sqft)? (Optional)",
        "ask_house_year_built": "In what *year was it built* (e.g., 2010)? (Optional)",
        "property_type_apartment": "Apartment", "property_type_house": "House", "property_type_land": "Land", "property_type_commercial": "Commercial Space", "property_type_other": "Other Type",
        "preview_title_houses": "üì¢ **Property for Sale**",
        "preview_field_house_property_type": "**Type:** {value}",
        "preview_field_house_rooms": "**Rooms:** {value}",
        "preview_field_house_area": "üìê **Area:** {value}",
        "preview_field_house_year_built": "**Year Built:** {value}",
        "btn_edit_house_property_type": "Property Type", 
        "btn_edit_house_rooms": "Rooms", 
        "btn_edit_house_area": "Area", 
        "btn_edit_house_year_built": "Year Built",

        # --- Category: Animals ---
        "category_chosen_animals": "üêÑ Got it! Let's get details for the animal.",
        "ask_animal_type": "What *type of animal* is it (e.g., Dog, Cat, Cow)?",
        "ask_animal_breed": "What's the *breed* of the {animal_type_placeholder}? (Optional)",
        "ask_animal_age": "How *old* is the animal (e.g., 2 years, 6 months)?",
        "ask_animal_sex": "What is the animal's *sex*? (Optional)",
        "animal_sex_male": "Male", "animal_sex_female": "Female",
        "preview_title_animals": "üì¢ **Animal for Sale/Adoption**",
        "preview_field_animal_type": "**Animal Type:** {value}",
        "preview_field_animal_breed": "**Breed:** {value}",
        "preview_field_animal_age": "**Age:** {value}",
        "preview_field_animal_sex": "**Sex:** {value}",
        "btn_edit_animal_type": "Animal Type", 
        "btn_edit_animal_breed": "Breed", 
        "btn_edit_animal_age": "Age", 
        "btn_edit_animal_sex": "Sex",

        # --- Category: Other ---
        "category_chosen_other": "üß∏ Understood! Let's get details for your item.",
        "ask_other_item_name": "What is the *name or type* of item you're selling?",
        "preview_title_other": "üì¢ **Item for Sale**",
        "preview_field_other_item_name": "**Item:** {value}",
        "btn_edit_other_item_name": "Item Name",

        # --- Common Preview Fields (can be used by all categories) ---
        "preview_field_price": "üíµ **Price:** {value}",
        "preview_field_location": "üìç **Location:** {value}",
        "preview_field_description": "üìù **Description:** {value}",
        "preview_field_no_description": "üìù **Description:** (No description provided)",
        "preview_media_info_photo": "üì∏ {count} Photo(s)",
        "preview_media_info_video": "üìπ {count} Video(s)",
        "preview_media_info_mixed": "üñºÔ∏è {count} Media file(s)",
    },
    'ru': {
        # --- General & Existing ---
        "welcome": "–ü—Ä–∏–≤–µ—Ç, {name}! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:",
        "lang_chosen": "–Ø–∑—ã–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ –†—É—Å—Å–∫–∏–π.",
        "choose_category": "–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–∞—Ç—å?",
        "ask_price": "–ö–∞–∫–∞—è *—Ü–µ–Ω–∞*? (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000000 —Ä—É–±. –∏–ª–∏ $15000)",
        "ask_location": "–í –∫–∞–∫–æ–º *–≥–æ—Ä–æ–¥–µ –∏–ª–∏ —Ä–∞–π–æ–Ω–µ* –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–æ–≤–∞—Ä?",
        "ask_description": "–î–æ–±–∞–≤—å—Ç–µ *–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ* (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –º–∞–∫—Å. {max_desc_len} —Å–∏–º–≤.).\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å.",
        "ask_media": "–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ (–¥–æ {max_media} —Ñ–∞–π–ª–æ–≤).\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã, –∑–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ.",
        "media_received": "–ú–µ–¥–∏–∞—Ñ–∞–π–ª –ø–æ–ª—É—á–µ–Ω ({count}/{max_media}). –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—â–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ '–ì–æ—Ç–æ–≤–æ'.",
        "max_media_reached": "–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ ({max_media}). –ù–∞–∂–º–∏—Ç–µ '–ì–æ—Ç–æ–≤–æ'.",
        "no_media_uploaded_error": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ.",
        "preview_confirm_prompt": "\n‚Äî ‚Äî ‚Äî ‚Äî ‚Äî\n\n‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é?\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
        "btn_post": "‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å", "btn_edit": "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", "btn_cancel": "‚ùå –û—Ç–º–µ–Ω–∏—Ç—å",
        "post_successful_channel": "‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤ {target_chat_id}!",
        "post_successful_admin": "‚úÖ –í–∞—à–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ!",
        "post_cancelled": "–ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ —Å /start.",
        "edit_choice_prompt": "–ß—Ç–æ –±—ã –≤—ã —Ö–æ—Ç–µ–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å? (–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –º–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞)",
        "btn_edit_price": "üí∞ –¶–µ–Ω–∞", "btn_edit_location": "üó∫Ô∏è –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ", "btn_edit_description": "üìÑ –û–ø–∏—Å–∞–Ω–∏–µ", "btn_edit_media": "üñºÔ∏è –ú–µ–¥–∏–∞",
        "btn_back_to_preview": "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä—É", "btn_done_media": "‚úÖ –ì–æ—Ç–æ–≤–æ —Å –º–µ–¥–∏–∞", "btn_clear_media": "üîÑ –û—á–∏—Å—Ç–∏—Ç—å –º–µ–¥–∏–∞",
        "btn_skip": "‚û°Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å",
        "btn_skip_description": "‚û°Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ",
        "description_skipped": "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ.", "media_cleared": "–í—Å–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã. –ú–æ–∂–µ—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ.",
        "invalid_input": "–ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω—è–ª. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏.",
        "price_invalid": "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ü–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 15000, $15000, 150.00 EUR).",
        "description_too_long": "–û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å. {max_desc_len} —Å–∏–º–≤–æ–ª–æ–≤). –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ –µ–≥–æ.",
        "general_error": "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ /cancel –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.",
        "timeout_message": "–í—Ä–µ–º—è —Å–µ—Å—Å–∏–∏ –∏—Å—Ç–µ–∫–ª–æ –∏–∑-–∑–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ —Å /start.",
        "conversation_restarted": "–ü—Ä–µ–¥—ã–¥—É—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –±—ã–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞. –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º —Å–Ω–∞—á–∞–ª–∞.",
        "category_cars": "üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–∏", "category_houses": "üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å", "category_animals": "üêÑ –ñ–∏–≤–æ—Ç–Ω—ã–µ", "category_other": "üß∏ –î—Ä—É–≥–æ–µ",
        "change_language_prompt": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π —è–∑—ã–∫:",
        "language_changed_success": "–Ø–∑—ã–∫ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ {new_lang_display}. –¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å–±—Ä–æ—à–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ.",
        "help_message": (
            "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π!\n\n"
            "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ:\n"
            "1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.\n"
            "2. –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.\n"
            "3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É.\n"
            "4. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ, –∑–∞—Ç–µ–º –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç–µ.\n\n"
            "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n"
            "/start - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ.\n"
            "/language - –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —è–∑—ã–∫.\n"
            "/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–ø—Ä–∞–≤–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.\n"
            "/cancel - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è."
        ),
        "field_skipped": "{field_name} –ø—Ä–æ–ø—É—â–µ–Ω–æ.",

        # --- Category: Cars ---
        "category_chosen_cars": "üöó –û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π—Ç–µ —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è.",
        "ask_car_make_model": "–£–∫–∞–∂–∏—Ç–µ *–ú–∞—Ä–∫—É –∏ –ú–æ–¥–µ–ª—å* –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Toyota Camry, BMW X5)?",
        "ask_car_year": "–ö–∞–∫–æ–π *–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞* –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2018)? (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
        "ask_car_mileage": "–ö–∞–∫–æ–π *–ü—Ä–æ–±–µ–≥* —É –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 55000 –∫–º)?",
        "preview_title_cars": "üì¢ **–ü—Ä–æ–¥–∞–µ—Ç—Å—è –ê–≤—Ç–æ–º–æ–±–∏–ª—å**",
        "preview_field_car_make_model": "**–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å:** {value}",
        "preview_field_car_year": "**–ì–æ–¥:** {value}",
        "preview_field_car_mileage": "üõ£Ô∏è **–ü—Ä–æ–±–µ–≥:** {value}",
        "btn_edit_car_make_model": "–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å", # NEW RUSSIAN
        "btn_edit_car_year": "–ì–æ–¥",               # NEW RUSSIAN
        "btn_edit_car_mileage": "–ü—Ä–æ–±–µ–≥", 

        # --- Category: Houses/Real Estate ---
        "category_chosen_houses": "üè† –•–æ—Ä–æ—à–æ! –î–∞–≤–∞–π—Ç–µ —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏.",
        "ask_house_property_type": "–ö–∞–∫–æ–π *—Ç–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏* –≤—ã –ø—Ä–æ–¥–∞–µ—Ç–µ?",
        "ask_house_rooms": "–°–∫–æ–ª—å–∫–æ *–∫–æ–º–Ω–∞—Ç* (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3)? (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
        "ask_house_area": "–ö–∞–∫–∞—è –ø—Ä–∏–º–µ—Ä–Ω–∞—è *–ø–ª–æ—â–∞–¥—å* (–Ω–∞–ø—Ä–∏–º–µ—Ä, 75 –∫–≤.–º, 12 —Å–æ—Ç–æ–∫)? (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
        "ask_house_year_built": "–í –∫–∞–∫–æ–º *–≥–æ–¥—É –ø–æ—Å—Ç—Ä–æ–µ–Ω* (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2010)? (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
        "property_type_apartment": "–ö–≤–∞—Ä—Ç–∏—Ä–∞", "property_type_house": "–î–æ–º", "property_type_land": "–ó–µ–º–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫", "property_type_commercial": "–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ", "property_type_other": "–î—Ä—É–≥–æ–π —Ç–∏–ø",
        "preview_title_houses": "üì¢ **–ü—Ä–æ–¥–∞–µ—Ç—Å—è –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å**",
        "preview_field_house_property_type": "**–¢–∏–ø:** {value}",
        "preview_field_house_rooms": "**–ö–æ–º–Ω–∞—Ç:** {value}",
        "preview_field_house_area": "üìê **–ü–ª–æ—â–∞–¥—å:** {value}",
        "preview_field_house_year_built": "**–ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏:** {value}",
        "btn_edit_house_property_type": "–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏", # NEW RUSSIAN
        "btn_edit_house_rooms": "–ö–æ–º–Ω–∞—Ç—ã",                 # NEW RUSSIAN
        "btn_edit_house_area": "–ü–ª–æ—â–∞–¥—å",                 # NEW RUSSIAN
        "btn_edit_house_year_built": "–ì–æ–¥ –ø–æ—Å—Ç—Ä–æ–π–∫–∏",   

        # --- Category: Animals ---
        "category_chosen_animals": "üêÑ –ü–æ–Ω—è—Ç–Ω–æ! –î–∞–≤–∞–π—Ç–µ —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏ –æ –∂–∏–≤–æ—Ç–Ω–æ–º.",
        "ask_animal_type": "–ö–∞–∫–æ–µ *–∂–∏–≤–æ—Ç–Ω–æ–µ* –≤—ã –ø—Ä–æ–¥–∞–µ—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –°–æ–±–∞–∫–∞, –ö–æ—à–∫–∞, –ö–æ—Ä–æ–≤–∞)?",
        "ask_animal_breed": "–ö–∞–∫–∞—è *–ø–æ—Ä–æ–¥–∞* —É {animal_type_placeholder}? (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
        "ask_animal_age": "–ö–∞–∫–æ–π *–≤–æ–∑—Ä–∞—Å—Ç* —É –∂–∏–≤–æ—Ç–Ω–æ–≥–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2 –≥–æ–¥–∞, 6 –º–µ—Å—è—Ü–µ–≤)?",
        "ask_animal_sex": "–ö–∞–∫–æ–π *–ø–æ–ª* —É –∂–∏–≤–æ—Ç–Ω–æ–≥–æ? (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
        "animal_sex_male": "–°–∞–º–µ—Ü", "animal_sex_female": "–°–∞–º–∫–∞",
        "preview_title_animals": "üì¢ **–ü—Ä–æ–¥–∞–µ—Ç—Å—è/–û—Ç–¥–∞–µ—Ç—Å—è –ñ–∏–≤–æ—Ç–Ω–æ–µ**",
        "preview_field_animal_type": "**–í–∏–¥ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ:** {value}",
        "preview_field_animal_breed": "**–ü–æ—Ä–æ–¥–∞:** {value}",
        "preview_field_animal_age": "**–í–æ–∑—Ä–∞—Å—Ç:** {value}",
        "preview_field_animal_sex": "**–ü–æ–ª:** {value}",
        "btn_edit_animal_type": "–í–∏–¥ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ",     # NEW RUSSIAN
        "btn_edit_animal_breed": "–ü–æ—Ä–æ–¥–∞",           # NEW RUSSIAN
        "btn_edit_animal_age": "–í–æ–∑—Ä–∞—Å—Ç",           # NEW RUSSIAN
        "btn_edit_animal_sex": "–ü–æ–ª",               # NEW RUSSIAN

        # --- Category: Other ---
        "category_chosen_other": "üß∏ –Ø—Å–Ω–æ! –î–∞–≤–∞–π—Ç–µ —É—Ç–æ—á–Ω–∏–º –¥–µ—Ç–∞–ª–∏ –≤–∞—à–µ–≥–æ —Ç–æ–≤–∞—Ä–∞.",
        "ask_other_item_name": "–ö–∞–∫ *–Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –∫–∞–∫–æ–π —Ç–∏–ø* —Ç–æ–≤–∞—Ä–∞ –≤—ã –ø—Ä–æ–¥–∞–µ—Ç–µ?",
        "preview_title_other": "üì¢ **–ü—Ä–æ–¥–∞–µ—Ç—Å—è –¢–æ–≤–∞—Ä**",
        "preview_field_other_item_name": "**–¢–æ–≤–∞—Ä:** {value}",
        "btn_edit_other_item_name": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞", # NEW RUSSIAN

        
        # --- Common Preview Fields ---
        "preview_field_price": "üíµ **–¶–µ–Ω–∞:** {value}",
        "preview_field_location": "üìç **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** {value}",
        "preview_field_description": "üìù **–û–ø–∏—Å–∞–Ω–∏–µ:** {value}",
        "preview_field_no_description": "üìù **–û–ø–∏—Å–∞–Ω–∏–µ:** (–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ)",
        "preview_media_info_photo": "üì∏ –§–æ—Ç–æ: {count}",
        "preview_media_info_video": "üìπ –í–∏–¥–µ–æ: {count}",
        "preview_media_info_mixed": "üñºÔ∏è –ú–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤: {count}",
    },
    'uz': {
        # --- General & Existing ---
        "welcome": "Salom, {name}! Iltimos, tilingizni tanlang:",
        "lang_chosen": "Til O'zbek tiliga o'rnatildi.",
        "choose_category": "Nimani sotmoqchisiz?",
        "ask_price": "*Narxini* kiriting (masalan, 15000000 so'm yoki $1500).",
        "ask_location": "Mahsulot qaysi *shahar yoki tumanda* joylashgan?",
        "ask_description": "*Qisqacha tavsif* qo'shing (ixtiyoriy, maksimal {max_desc_len} belgi).\nTavsifni yuboring yoki o'tkazib yuborish uchun quyidagi tugmani bosing.",
        "ask_media": "Foto yoki video yuklang ({max_media} tagacha fayl).\nMediani yuboring, keyin quyidagi tugmalardan foydalaning.",
        "media_received": "Media qabul qilindi ({count}/{max_media}). Yana yuboring yoki 'Bajarildi' tugmasini bosing.",
        "max_media_reached": "Maksimal media fayllar soni ({max_media}) yetdi. 'Bajarildi' tugmasini bosing.",
        "no_media_uploaded_error": "Iltimos, kamida bitta foto yoki video yuklang.",
        "preview_confirm_prompt": "\n‚Äî ‚Äî ‚Äî ‚Äî ‚Äî\n\n‚úÖ Chop etishni tasdiqlaysizmi?\nVariantni tanlang:",
        "btn_post": "‚úÖ Chop etish", "btn_edit": "‚úèÔ∏è Tahrirlash", "btn_cancel": "‚ùå Bekor qilish",
        "post_successful_channel": "‚úÖ {target_chat_id} kanaliga muvaffaqiyatli joylandi!",
        "post_successful_admin": "‚úÖ E'loningiz ko'rib chiqish uchun yuborildi!",
        "post_cancelled": "Nashr bekor qilindi. /start bilan qaytadan boshlashingiz mumkin.",
        "edit_choice_prompt": "Nimani tahrirlamoqchisiz? (Eslatma: ba'zi maydonlar ushbu bo'limni qayta boshlashni talab qilishi mumkin)",
        "btn_edit_price": "üí∞ Narxi", 
        "btn_edit_location": "üó∫Ô∏è Joylashuvi", 
        "btn_edit_description": "üìÑ Tavsifi", 
        "btn_edit_media": "üñºÔ∏è Media",
        "btn_back_to_preview": "‚Ü©Ô∏è Ko'rib chiqishga qaytish", 
        "btn_done_media": "‚úÖ Yuklash Bajarildi", 
        "btn_clear_media": "üîÑ Barcha Mediani Tozalash",
        "btn_skip": "‚û°Ô∏è O'tkazib Yuborish",
        "btn_skip_description": "‚û°Ô∏è Tavsifni o'tkazib yuborish",
        "description_skipped": "Tavsif o'tkazib yuborildi.", "media_cleared": "Barcha media tozalandi. Yangilarini yuklashingiz mumkin.",
        "invalid_input": "Kechirasiz, tushunmadim. Iltimos, ko'rsatmalarga amal qiling yoki tugmalardan foydalaning.",
        "price_invalid": "Narx formati noto'g'ri. Iltimos, to'g'ri narx kiriting (masalan, 150000, $1500, 150.00 EUR).",
        "description_too_long": "Tavsif juda uzun (maksimal {max_desc_len} belgi). Iltimos, qisqartiring.",
        "general_error": "Xatolik yuz berdi. Iltimos, qaytadan urinib ko'ring yoki /cancel tugmasini bosing.",
        "timeout_message": "Faoliyatsizlik tufayli suhbat vaqti tugadi. Iltimos, /start bilan qaytadan boshlang.",
        "conversation_restarted": "Avvalgi amal bekor qilindi. Keling, boshidan boshlaymiz.",
        "category_cars": "üöó Avtomobillar", "category_houses": "üè† Ko'chmas Mulk", "category_animals": "üêÑ Hayvonlar", "category_other": "üß∏ Boshqalar",
        "change_language_prompt": "Iltimos, yangi tilingizni tanlang:",
        "language_changed_success": "Til muvaffaqiyatli {new_lang_display} ga o'zgartirildi. Joriy e'lon yaratish jarayoni tiklandi. Yangi e'lon boshlash uchun /start dan foydalaning.",
        "help_message": (
            "E'lon Joylash Botiga Xush Kelibsiz!\n\n"
            "E'lonni qanday yaratish mumkin:\n"
            "1. Boshlash uchun /start dan foydalaning.\n"
            "2. Kategoriyani tanlang va tafsilotlar uchun ko'rsatmalarga amal qiling.\n"
            "3. So'ralganda foto/video yuklang.\n"
            "4. E'loningizni ko'rib chiqing, so'ngra joylashtiring, tahrirlang yoki bekor qiling.\n\n"
            "Mavjud buyruqlar:\n"
            "/start - Yangi e'lon yaratish.\n"
            "/language - Tilni o'zgartirish.\n"
            "/help - Ushbu yordam xabarini ko'rsatish.\n"
            "/cancel - Joriy e'lon yaratish jarayonini bekor qilish."
        ),
        "field_skipped": "{field_name} o'tkazib yuborildi.",

        # --- Category: Cars ---
        "category_chosen_cars": "üöó Ajoyib! Keling, avtomobil tafsilotlarini olaylik.",
        "ask_car_make_model": "Avtomobilning *Markasi va Modeli* qanday (masalan, Toyota Camry, BMW X5)?",
        "ask_car_year": "Avtomobilning *Ishlab chiqarilgan yili* qaysi (masalan, 2018)? (Ixtiyoriy)",
        "ask_car_mileage": "Avtomobilning *Bosgan masofasi* (probegi) qancha (masalan, 55000 km)?",
        "preview_title_cars": "üì¢ **Avtomobil Sotiladi**",
        "preview_field_car_make_model": "**Marka/Model:** {value}",
        "preview_field_car_year": "**Yili:** {value}",
        "preview_field_car_mileage": "üõ£Ô∏è **Probeg:** {value}",
        "btn_edit_car_make_model": "Marka/Modeli", # NEW UZBEK
        "btn_edit_car_year": "Yili",              # NEW UZBEK
        "btn_edit_car_mileage": "Probegi",         # NEW UZBEK
        
        # --- Category: Houses/Real Estate ---
        "category_chosen_houses": "üè† Yaxshi! Keling, ko'chmas mulk tafsilotlarini olaylik.",
        "ask_house_property_type": "Qanday *turda ko'chmas mulk* sotyapsiz?",
        "ask_house_rooms": "Nechta *xonasi* bor (masalan, 3)? (Ixtiyoriy)",
        "ask_house_area": "Taxminiy *maydoni* qancha (masalan, 75 kv.m, 6 sotix)? (Ixtiyoriy)",
        "ask_house_year_built": "Qaysi *yili qurilgan* (masalan, 2010)? (Ixtiyoriy)",
        "property_type_apartment": "Kvartira", "property_type_house": "Hovli Uy", "property_type_land": "Yer Uchastkasi", "property_type_commercial": "Tijorat Joyi", "property_type_other": "Boshqa Tur",
        "preview_title_houses": "üì¢ **Ko'chmas Mulk Sotiladi**",
        "preview_field_house_property_type": "**Turi:** {value}",
        "preview_field_house_rooms": "**Xonalar soni:** {value}",
        "preview_field_house_area": "üìê **Maydoni:** {value}",
        "preview_field_house_year_built": "**Qurilgan yili:** {value}",
        "btn_edit_house_property_type": "Mulk Turi", # NEW UZBEK
        "btn_edit_house_rooms": "Xonalar Soni",     # NEW UZBEK
        "btn_edit_house_area": "Maydoni",           # NEW UZBEK
        "btn_edit_house_year_built": "Qurilgan Yili",# NEW UZBEK

        # --- Category: Animals ---
        "category_chosen_animals": "üêÑ Tushunarli! Keling, hayvon haqida ma'lumot olaylik.",
        "ask_animal_type": "Qanday *hayvon* sotyapsiz (masalan, Kuchuk, Mushuk, Sigir)?",
        "ask_animal_breed": "{animal_type_placeholder}ning *zoti* qanday? (Ixtiyoriy)",
        "ask_animal_age": "Hayvonning *yoshi* qancha (masalan, 2 yosh, 6 oylik)?",
        "ask_animal_sex": "Hayvonning *jinsi* qanday? (Ixtiyoriy)",
        "animal_sex_male": "Erkak", "animal_sex_female": "Urg'ochi",
        "preview_title_animals": "üì¢ **Hayvon Sotiladi/Beriladi**",
        "preview_field_animal_type": "**Hayvon Turi:** {value}",
        "preview_field_animal_breed": "**Zoti:** {value}",
        "preview_field_animal_age": "**Yoshi:** {value}",
        "preview_field_animal_sex": "**Jinsi:** {value}",
        "btn_edit_animal_type": "Hayvon Turi",    # NEW UZBEK
        "btn_edit_animal_breed": "Zoti",          # NEW UZBEK
        "btn_edit_animal_age": "Yoshi",           # NEW UZBEK
        "btn_edit_animal_sex": "Jinsi",           # NEW UZBEK

        # --- Category: Other ---
        "category_chosen_other": "üß∏ Bo'ldi! Keling, mahsulotingiz haqida ma'lumot olaylik.",
        "ask_other_item_name": "Sotayotgan mahsulotingizning *nomi yoki turi* nima?",
        "preview_title_other": "üì¢ **Mahsulot Sotiladi**",
        "preview_field_other_item_name": "**Mahsulot:** {value}",
        "btn_edit_other_item_name": "Mahsulot Nomi", # NEW UZBEK

        
        # --- Common Preview Fields ---
        "preview_field_price": "üíµ **Narxi:** {value}",
        "preview_field_location": "üìç **Joylashuvi:** {value}",
        "preview_field_description": "üìù **Tavsifi:** {value}",
        "preview_field_no_description": "üìù **Tavsifi:** (Tavsif berilmagan)",
        "preview_media_info_photo": "üì∏ {count} ta Rasm",
        "preview_media_info_video": "üìπ {count} ta Video",
        "preview_media_info_mixed": "üñºÔ∏è {count} ta Media fayl",
    }
}

def get_text(key: str, lang_code: str = DEFAULT_LANGUAGE, **kwargs) -> str:
    """Retrieves a localized string."""
    if lang_code not in SUPPORTED_LANGUAGES:
        lang_code = DEFAULT_LANGUAGE
    
    # Handle dynamic placeholders like {animal_type_placeholder}
    # This ensures that if a placeholder isn't provided, it doesn't crash .format()
    # You might want to handle this more gracefully, e.g., by having default empty strings for placeholders
    # or ensuring they are always passed. For now, this just makes it robust against missing kwargs.
    # Example: "ask_animal_breed": "What's the *breed* of the {animal_type_placeholder}? (Optional)",
    # If 'animal_type_placeholder' is not in kwargs, it will remain as {animal_type_placeholder}
    # This might be acceptable or you might want to refine it.

    text_template = strings.get(lang_code, strings[DEFAULT_LANGUAGE]).get(key, f"_{key}_")

    # Special formatting for max description length
    if key == "ask_description" or key == "description_too_long":
        from config import MAX_DESCRIPTION_LENGTH # Import here to avoid circular at top
        actual_kwargs = {'max_desc_len': MAX_DESCRIPTION_LENGTH, **kwargs}
        return text_template.format(**actual_kwargs)
    
    if key == "ask_media" or key == "media_received" or key == "max_media_reached":
        actual_kwargs = {'max_media': MAX_MEDIA_ITEMS, **kwargs}
        return text_template.format(**actual_kwargs)
        
    # For other keys, format with provided kwargs
    # If a kwarg is missing for a placeholder in the template, .format() will raise a KeyError.
    # To prevent this, you could use .format_map(defaultdict(str, **kwargs)) or similar.
    # For simplicity now, assume necessary kwargs are passed for placeholders.
    try:
        return text_template.format(**kwargs)
    except KeyError as e:
        # Log this or handle it - means a placeholder was in the string but not in kwargs
        # print(f"Warning: Missing key {e} for string '{key}' with lang '{lang_code}' and kwargs {kwargs}")
        return text_template # Return unformatted template as a fallback


def get_user_lang(context: ContextTypes.DEFAULT_TYPE) -> str:
    """Gets the user's selected language from context, defaults to DEFAULT_LANGUAGE."""
    return context.user_data.get('lang', DEFAULT_LANGUAGE)

def get_category_display_name(category_key: str, lang_code: str) -> str:
    """Gets the localized display name for a category key."""
    localization_key = f"category_{category_key}"
    return get_text(localization_key, lang_code)